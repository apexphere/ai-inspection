// AI Inspection Database Schema
// See: docs/design/002-backend-service-architecture.md

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Inspection {
  id            String    @id @default(uuid())
  address       String
  clientName    String
  inspectorName String?
  checklistId   String
  status        Status    @default(STARTED)
  currentSection String
  metadata      Json?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  completedAt   DateTime?
  
  findings      Finding[]
  reports       Report[]
}

model Finding {
  id            String    @id @default(uuid())
  inspectionId  String
  inspection    Inspection @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  section       String
  text          String
  severity      Severity  @default(INFO)
  matchedComment String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  photos        Photo[]
}

model Photo {
  id          String   @id @default(uuid())
  findingId   String
  finding     Finding  @relation(fields: [findingId], references: [id], onDelete: Cascade)
  filename    String
  path        String
  mimeType    String
  createdAt   DateTime @default(now())
}

model Report {
  id            String    @id @default(uuid())
  inspectionId  String
  inspection    Inspection @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  format        String    @default("pdf")
  path          String
  createdAt     DateTime  @default(now())
}

enum Status {
  STARTED
  IN_PROGRESS
  COMPLETED
}

enum Severity {
  INFO
  MINOR
  MAJOR
  URGENT
}
