#!/bin/sh

echo "ğŸš€ Running pre-push checks (full lint + typecheck)..."

REPO_ROOT="$(git rev-parse --show-toplevel)"

# Check api
echo "ğŸ“¦ Checking api..."
cd "$REPO_ROOT/api" && npm run typecheck && npm run lint || exit 1

# Validate Prisma schema (use dummy URL for syntax check only)
echo "ğŸ” Validating Prisma schema..."
cd "$REPO_ROOT/api"
DATABASE_URL="postgresql://localhost/dummy" npx prisma validate || exit 1

# Check web
echo "ğŸ“¦ Checking web..."
cd "$REPO_ROOT/web" && npm run typecheck && npm run lint || exit 1

# Check server
echo "ğŸ“¦ Checking server..."
cd "$REPO_ROOT/server" && npm run typecheck && npm run lint || exit 1

echo "âœ… Pre-push checks passed!"
