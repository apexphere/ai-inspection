#!/bin/sh

echo "ğŸ” Running pre-commit checks..."

REPO_ROOT="$(git rev-parse --show-toplevel)"

# Check api workspace
if git diff --cached --name-only | grep -q "^api/"; then
  echo "ğŸ“¦ Checking api..."
  cd "$REPO_ROOT/api"
  npm run typecheck || exit 1
  npm run lint || exit 1
fi

# Check web workspace
if git diff --cached --name-only | grep -q "^web/"; then
  echo "ğŸ“¦ Checking web..."
  cd "$REPO_ROOT/web"
  npm run typecheck || exit 1
  npm run lint || exit 1
fi

# Check server workspace (MCP server)
if git diff --cached --name-only | grep -q "^server/"; then
  echo "ğŸ“¦ Checking server..."
  cd "$REPO_ROOT/server"
  npm run typecheck || exit 1
  npm run lint || exit 1
fi

echo "âœ… Pre-commit checks passed!"
